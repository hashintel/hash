extend = { path = "../../../.github/scripts/rust/Makefile.toml" }

[env]
CARGO_CLIPPY_HACK_FLAGS = "--workspace --feature-powerset --exclude-features default --optional-deps eyre,anyhow"
CARGO_TEST_HACK_FLAGS = "--workspace --feature-powerset --exclude-features default --optional-deps eyre,anyhow"
CARGO_MIRI_FLAGS = "--tests --lib"

[tasks.test]
env = { CARGO_TEST_HACK_FLAGS = "${CARGO_TEST_HACK_FLAGS} --group-features anyhow,eyre --group-features std,hooks --group-features spantrace,futures,small" }


[tasks.test-release]
category = "Test"
description = "Runs the complete test suite with all permutations"
extend = "test"
env = { CARGO_TEST_HACK_FLAGS = { source = "CARGO_TEST_HACK_FLAGS" } }

[tasks.test-task]
dependencies = ["install-rust-src"]

# Required for UI tests
[tasks.install-rust-src]
private = true
install_crate = { rustup_component_name = "rust-src" }
