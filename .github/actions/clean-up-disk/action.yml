name: Clean up disk
description: "Cleans up disk space by removing unnecessary files"

runs:
  using: "composite"
  steps:
    - name: Check disk space
      shell: bash
      run: |
        echo "Overal disk space usage before cleanup:"
        df -h
        echo

        echo "Top directories in /usr before cleanup:"
        du -h --max-depth=1 /usr 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /usr/lib before cleanup:"
        du -h --max-depth=2 /usr/lib 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /usr/local before cleanup:"
        du -h --max-depth=2 /usr/local 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /usr/share before cleanup:"
        du -h --max-depth=2 /usr/share 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /var before cleanup:"
        du -h --max-depth=2 /var 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /opt before cleanup:"
        du -h --max-depth=2 /opt 2>/dev/null | sort -rh | head -n 30
        echo

    - name: Remove unused files
      shell: bash
      run: |
        echo "Removing unused files..."
        # sudo rm -rf \
        #   /usr/share/dotnet \
        #   /usr/share/swift \
        #   /usr/lib/jvm \
        #   /usr/local/.ghcup \
        #   /usr/local/lib/android \
        #   /usr/local/share/powershell \
        #   /opt/ghc
        echo

    - name: Remove unused packages
      shell: bash
      run: |
        echo "Removing unused packages..."
        sudo apt-get autoremove -y
        sudo apt-get autoclean -y
        echo


    - name: Check disk space
      shell: bash
      run: |
        echo "Overal disk space usage after cleanup:"
        df -h
        echo

        echo "Top directories in /usr after cleanup:"
        du -h --max-depth=2 /usr 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /var after cleanup:"
        du -h --max-depth=2 /var 2>/dev/null | sort -rh | head -n 30
        echo

        echo "Top directories in /opt after cleanup:"
        du -h --max-depth=2 /opt 2>/dev/null | sort -rh | head -n 30
        echo
