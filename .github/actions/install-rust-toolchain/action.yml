name: Install Rust toolchain
description: "Install Rust toolchain"

inputs:
  toolchain:
    required: true
    description: "Rust toolchain, e.g. 'stable' or 'nightly'"
  working-directory:
    description: "Working directory to run the action in"
    required: false
    default: "."

runs:
  using: "composite"
  steps:
    - name: "Install Rust"
      working-directory: ${{ inputs.working-directory }}
      run: |
        rustup set profile minimal

        # If the toolchain does match `rust-toolchain.toml` we can rely on `rustup show` to install the toolchain. If it
        # does not match, we need to install the toolchain manually.
        if grep -q "${{ inputs.toolchain }}" rust-toolchain.toml; then
          rustup show
        else
          export RUSTUP_TOOLCHAIN=${{ inputs.toolchain }}
          rustup default "$RUSTUP_TOOLCHAIN"
          rustup component add rustfmt
          rustup component add clippy
          rustup show
        fi

        echo "RUSTUP_TOOLCHAIN=${{ inputs.toolchain }}" >> $GITHUB_ENV
      shell: bash
