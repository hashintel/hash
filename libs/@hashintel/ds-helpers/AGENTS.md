# @hashintel/ds-helpers - Agent Context

## Purpose

This package generates and distributes the **Panda CSS styled-system** for the HASH design system. It sits in the middle of a 3-part architecture:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   ds-theme      │────▶│   ds-helpers    │────▶│  ds-components  │
│  (Panda Preset) │     │ (Styled System) │     │ (React + Ark UI)│
└─────────────────┘     └─────────────────┘     └─────────────────┘
        │                    ▲ YOU ARE HERE             │
   Design tokens          css(), cva(),           Button, Checkbox,
   from Figma             tokens, jsx             Avatar, etc.
```

- **Consumes**: `@hashintel/ds-theme` preset (design tokens, semantic colors, typography, spacing)
- **Produces**: Generated styled-system utilities via Panda CSS codegen
- **Consumed by**: `@hashintel/ds-components` for building UI components

## Architecture

### Panda CSS Configuration

The package uses `@hashintel/ds-theme` as its preset to inherit all design tokens:

```ts
// panda.config.ts
import { defineConfig } from '@pandacss/dev';

export default defineConfig({
  presets: ['@hashintel/ds-theme'],
  // ...
});
```

### Generated Output

The `styled-system/` directory is generated by Panda CSS codegen and exported as the package's public API:

| Export | Description |
|--------|-------------|
| `@hashintel/ds-helpers/css` | `css()`, `cva()`, `sva()` utility functions |
| `@hashintel/ds-helpers/tokens` | `token()` function and token type definitions |
| `@hashintel/ds-helpers/types` | TypeScript types for style properties |
| `@hashintel/ds-helpers/patterns` | Layout patterns (stack, flex, grid, etc.) |
| `@hashintel/ds-helpers/jsx` | Styled JSX components (Box, Flex, Stack, etc.) |
| `@hashintel/ds-helpers/styles.css` | Generated CSS stylesheet |

### Usage in ds-components

Components in `@hashintel/ds-components` import utilities from this package:

```tsx
import { css, cva } from '@hashintel/ds-helpers/css';
import { token } from '@hashintel/ds-helpers/tokens';
import { Box, Flex } from '@hashintel/ds-helpers/jsx';
```

## Ladle (Component Stories)

Stories are used to visualize and test the styled-system utilities.

### Story Pattern

Stories must be re-exported from a `.stories.ts` file for React Fast Refresh:

```ts
// stories/example.stories.ts
export default {
  title: 'Example',
};

export { ExampleStory } from './example.story';
```

The actual story implementation lives in `.story.tsx` files:

```tsx
// stories/example.story.tsx
import type { Story } from '@ladle/react';
import { css } from '../styled-system/css';

export const ExampleStory: Story = () => {
  return <div className={css({ color: 'primary.500' })}>Hello</div>;
};
```

## Visual Regression Testing

This package uses Playwright for visual regression testing of the styled-system output.

- **Config**: `playwright.config.ts`
- **Tests**: `tests/` directory
- **Reports**: `playwright-report/`
- **Results**: `test-results/`

Run tests with: `yarn test`
Update snapshots with: `yarn test:update`

## Scripts

| Script | Description |
|--------|-------------|
| `yarn dev` | Run Panda codegen (watch) + Ladle dev server |
| `yarn build` | Run Panda codegen + build Ladle static site |
| `yarn codegen` | Run Panda codegen only (with --clean) |
| `yarn test` | Build Ladle + run Playwright visual tests |
| `yarn test:update` | Build Ladle + update Playwright snapshots |
| `yarn lint:tsc` | TypeScript type checking |

## File Structure

```
libs/@hashintel/ds-helpers/
├── stories/              # Ladle stories for styled-system
│   ├── *.stories.ts      # Story entry points (for Fast Refresh)
│   └── *.story.tsx       # Story implementations
├── styled-system/        # Panda CSS generated output (committed)
│   ├── css/              # css(), cva(), sva() functions
│   ├── jsx/              # Styled JSX components
│   ├── patterns/         # Layout patterns
│   ├── tokens/           # Token utilities
│   ├── types/            # TypeScript types
│   └── styles.css        # Generated stylesheet
├── tests/                # Playwright visual regression tests
├── panda.config.ts       # Panda CSS configuration
├── playwright.config.ts  # Playwright configuration
├── postcss.config.cjs    # PostCSS configuration
├── vite.config.ts        # Vite configuration (for Ladle)
└── package.json
```

## Related Packages

- **ds-theme**: Design tokens from Figma (`libs/@hashintel/ds-theme`)
- **ds-components**: React components using these utilities (`libs/@hashintel/ds-components`)
